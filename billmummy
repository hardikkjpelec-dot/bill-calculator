<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Electricity Bill Calculator (Slab + Fuel + Vidhyut Shulk)</title>
  <style>
    body{font-family:system-ui,Arial;max-width:820px;margin:24px auto;padding:0 16px}
    .card{border:1px solid #ddd;border-radius:12px;padding:16px;margin:12px 0}
    label{display:block;margin:10px 0 6px;font-weight:600}
    input,select{width:100%;padding:10px;border:1px solid #ccc;border-radius:10px;font-size:16px}
    button{padding:10px 14px;border:0;border-radius:10px;font-size:16px;cursor:pointer}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
    .mono{font-family:ui-monospace,Consolas,monospace;white-space:pre-wrap}
    .err{color:#b00020}
    .ok{color:#0b6}
    small{color:#555}
  </style>
</head>
<body>
  <h2>Electricity Bill Calculator</h2>

  <div class="card">
    <div class="row">
      <div>
        <label>Previous reading</label>
        <input id="prev" type="number" min="0" placeholder="e.g., 12450">
      </div>
      <div>
        <label>Present reading</label>
        <input id="curr" type="number" min="0" placeholder="e.g., 12510">
      </div>
    </div>

    <div class="row3" style="margin-top:10px">
      <div>
        <label>Fuel rate (₹/unit)</label>
        <input id="fuelRate" type="number" min="0" step="0.01" value="2.35">
        <small>Default: 2.35</small>
      </div>
      <div>
        <label>Vidhyut Shulk (%)</label>
        <input id="shulkPct" type="number" min="0" step="0.01" value="15">
        <small>Default: 15%</small>
      </div>
      <div>
        <label>Sanction load (kW)</label>
        <input id="loadKw" type="number" min="0" step="0.1" value="6">
        <small>Default: 6 kW</small>
      </div>
    </div>

    <div style="margin-top:10px">
      <label>Billing cycle</label>
      <select id="cycle">
        <option value="1">1 month</option>
        <option value="2" selected>2 months</option>
      </select>
      <small>Fixed charge will be applied as per selected cycle.</small>
    </div>

    <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
      <button onclick="calculate()">Calculate</button>
      <button onclick="copyResult()">Copy result</button>
      <button onclick="resetAll()">Reset</button>
    </div>

    <p id="msg" class="err"></p>
  </div>

  <div class="card">
    <h3>Result</h3>
    <div id="out" class="mono">Enter readings and click Calculate.</div>
  </div>

<script>
  function money(n){ return "₹ " + (Math.round(n*100)/100).toFixed(2); }

  // Energy slab rates (CITY) from your table:
  // 0-100: 3.05
  // 101-200: 3.50
  // 201-500: 4.15
  // 501 onward: 5.20
  function calcEnergyChargeCity(units){
    let remaining = units;
    let ec = 0;

    const slab1 = Math.min(remaining, 100);
    ec += slab1 * 3.05;
    remaining -= slab1;

    if (remaining > 0){
      const slab2 = Math.min(remaining, 100);
      ec += slab2 * 3.50;
      remaining -= slab2;
    }

    if (remaining > 0){
      const slab3 = Math.min(remaining, 300); // 201-500 => 300 units
      ec += slab3 * 4.15;
      remaining -= slab3;
    }

    if (remaining > 0){
      ec += remaining * 5.20; // 501 onward
    }

    return ec;
  }

  // Fixed charge table from your image:
  // KW            1 month   2 months
  // up to 2       15       30
  // 2 to 4        25       50
  // 4 to 6        45       90
  // > 6           70       140
  function calcFixedCharge(loadKw, cycleMonths){
    const m = (cycleMonths === 2) ? 2 : 1;

    if (loadKw <= 2) return (m === 1) ? 15 : 30;
    if (loadKw <= 4) return (m === 1) ? 25 : 50;
    if (loadKw <= 6) return (m === 1) ? 45 : 90;
    return (m === 1) ? 70 : 140;
  }

  function calculate(){
    const msg = document.getElementById("msg");
    msg.className = "err";
    msg.textContent = "";

    const prev = Number(document.getElementById("prev").value);
    const curr = Number(document.getElementById("curr").value);

    const fuelRate = Number(document.getElementById("fuelRate").value); // ₹/unit
    const shulkPct = Number(document.getElementById("shulkPct").value); // %
    const loadKw = Number(document.getElementById("loadKw").value);     // kW
    const cycleMonths = Number(document.getElementById("cycle").value); // 1 or 2

    if (!Number.isFinite(prev) || !Number.isFinite(curr)) {
      msg.textContent = "Enter both readings.";
      return;
    }
    if (prev < 0 || curr < 0) {
      msg.textContent = "Readings cannot be negative.";
      return;
    }
    if (curr < prev) {
      msg.textContent = "Present reading must be >= previous reading.";
      return;
    }
    if (!Number.isFinite(fuelRate) || fuelRate < 0){
      msg.textContent = "Fuel rate must be a valid non-negative number.";
      return;
    }
    if (!Number.isFinite(shulkPct) || shulkPct < 0){
      msg.textContent = "Vidhyut Shulk % must be a valid non-negative number.";
      return;
    }
    if (!Number.isFinite(loadKw) || loadKw <= 0){
      msg.textContent = "Sanction load (kW) must be a valid number > 0.";
      return;
    }
    if (![1,2].includes(cycleMonths)){
      msg.textContent = "Billing cycle must be 1 or 2 months.";
      return;
    }

    const units = curr - prev;

    // 1) Energy charge (slab)
    const energyCharge = calcEnergyChargeCity(units);

    // 2) Fixed charge (by kW and cycle)
    const fixedCharge = calcFixedCharge(loadKw, cycleMonths);

    // 3) Fuel charge (units × fuel rate)
    const fuelCharge = units * fuelRate;

    // 4) Vidhyut Shulk = % of (fixed + energy + fuel)
    const base = fixedCharge + energyCharge + fuelCharge;
    const vidhyutShulk = (shulkPct / 100) * base;

    const total = base + vidhyutShulk;

    const text =
`Previous: ${prev}
Present : ${curr}
Units   : ${units}

Inputs:
- Fuel rate        : ${fuelRate} ₹/unit
- Vidhyut Shulk    : ${shulkPct} %
- Sanction load    : ${loadKw} kW
- Billing cycle    : ${cycleMonths} month(s)

Charges:
1) Energy Charges  : ${money(energyCharge)}
2) Fixed Charges   : ${money(fixedCharge)}  (as per ${cycleMonths} month(s))
3) Fuel Charges    : ${money(fuelCharge)}
4) Vidhyut Shulk   : ${money(vidhyutShulk)}   (= ${shulkPct}% of (1+2+3))

TOTAL BILL: ${money(total)}`;

    document.getElementById("out").textContent = text;
    msg.textContent = "Calculated successfully.";
    msg.className = "ok";
  }

  async function copyResult(){
    const text = document.getElementById("out").textContent;
    try {
      await navigator.clipboard.writeText(text);
      const msg = document.getElementById("msg");
      msg.textContent = "Copied to clipboard.";
      msg.className = "ok";
    } catch (e) {
      const msg = document.getElementById("msg");
      msg.textContent = "Copy failed (browser blocked clipboard).";
      msg.className = "err";
    }
  }

  function resetAll(){
    document.getElementById("prev").value = "";
    document.getElementById("curr").value = "";
    document.getElementById("fuelRate").value = "2.35";
    document.getElementById("shulkPct").value = "15";
    document.getElementById("loadKw").value = "6";
    document.getElementById("cycle").value = "2"; // default to 2 months
    document.getElementById("out").textContent = "Enter readings and click Calculate.";
    const msg = document.getElementById("msg");
    msg.textContent = "";
    msg.className = "err";
  }
</script>
</body>
</html>
